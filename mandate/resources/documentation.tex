\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{parskip}
\usepackage{fullpage}
\usepackage{hyperref}

\hypersetup{
    colorlinks=true,
    linkcolor=black,
    urlcolor=blue,
    pdftitle={Blockchain},
    pdfpagemode=FullScreen,
}

\title{Blockchain}
\author{Paolo Bettelini, Giacinto Di Santis, Gianni Grasso}
\date{}

\begin{document}

\maketitle
\tableofcontents
\pagebreak

\section{Block}

Each user owns a pair of private and public key.

All the transactions broadcasted to the network are grouped into blocks, which contain

\begin{itemize}
    \item Markle tree root hash
    \item Timestamp
    \item nBits (PoW)
    \item Nonce (PoW)
    \item Previous block hash
    \item Number of transactions
\end{itemize}

With each block being confirmed, the blockchain is created.

\section{Proof of Work}

Proof-of-Work (PoW) is a cryptographic proof that a party has spent
a certian amount of computational effort.

When a miner solves the puzzle the current block is archived, a new
block is generated and all the transactions in the previous block are confirmed.
The miner is then rewarded by the system.

\section{Proof of Stake}

\pagebreak

\section{Smart Contracts}

Smart contracs are programs associated with an address and run on the blockchain.
The nodes run code from the contract program at a relevant event, such as a received transation.

Users can interact with the contract via transactions. Contracts can often interact with other contracts
and some of them are Turing-complete.

\subsection{Deployment}

A smart contract is deployed by sending a transaction to the blockchain which includes the compiled program
as well as a special receiver address.

The program is added to the current block. When the block is added to the blockchain, the contract
will execute one time to set its initial state, at which point the smart contract will now be valid and running.


\pagebreak

\section{Requirements}
\bgroup{}
\def\arraystretch{1.25}
\begin{center}
    \begin{tabular}{ |l|p{9cm}| }
        \hline
        \multicolumn{2}{|c|}{\textbf{Req-01}} \\
        \hline
        \textbf{Name} & BlockChain \\
        \hline
        \textbf{Priority} & 1 \\
        \hline
        \textbf{Version} & 1.0 \\
        \hline
        \textbf{Notes} & none \\
        \hline
        \textbf{Description} & It is required to create a Blockchain based on PoS interacting with each node of the chain. \\
        \hline
        \multicolumn{2}{|c|}{\textbf{Subrequirements}} \\
        \hline
        \textbf{Req-01\_0} & There must be implemented the Proof of Stake (PoS). \\
        \hline
        \textbf{Req-01\_1} & There must be implemented a peer discovery algorithm. \\
        \hline
        \textbf{Req-01\_2} & There must be implemented a consensus algorithm. \\
        \hline
        \textbf{Req-01\_3} & There must be implemented a P2P algorithm. \\
        \hline
        \textbf{Req-01\_4} & There must be implemented a Gossip algorithm. \\
        \hline
    \end{tabular}
\end{center}
\egroup{}

\bgroup{}
\def\arraystretch{1.25}
\begin{center}
    \begin{tabular}{ |l|p{9cm}| }
        \hline
        \multicolumn{2}{|c|}{\textbf{Req-02}} \\
        \hline
        \textbf{Name} & Node \\
        \hline
        \textbf{Priority} & 1 \\
        \hline
        \textbf{Version} & 1.0 \\
        \hline
        \textbf{Notes} & none \\
        \hline
        \textbf{Description} & It is required that a computing machine can become a node of the blockchain.. \\
        \hline
        \multicolumn{2}{|c|}{\textbf{Subrequirements}} \\
        \hline
        \textbf{Req-01\_0} & Each node must have the blockchain saved locally as a SQLite database. \\
        \hline
        \textbf{Req-01\_1} & There must be implemented an algorithm that allow al nodes to perform the proof of stake. \\
        \hline
        \textbf{Req-01\_2} & Every node must be capable of executing a transaction. \\
        \hline
        \textbf{Req-01\_3} & Any node must be able to make a smart contract. \\
        \hline
    \end{tabular}
\end{center}
\egroup{}

\bgroup{}
\def\arraystretch{1.25}
\begin{center}
    \begin{tabular}{ |l|p{9cm}| }
        \hline
        \multicolumn{2}{|c|}{\textbf{Req-03}} \\
        \hline
        \textbf{Name} & Transaction \\
        \hline
        \textbf{Priority} & 1 \\
        \hline
        \textbf{Version} & 1.0 \\
        \hline
        \textbf{Notes} & none \\
        \hline
        \textbf{Description} & On the blockchain it must be able to make transactions, both for cryptocurrency and for smart contacts. \\
        \hline
        \multicolumn{2}{|c|}{\textbf{Subrequirements}} \\
        \hline
        \textbf{Req-01\_0} & There must be implemented an algorithm that validates the transaction and adds it to the block. \\
        \hline
        \textbf{Req-01\_0} & There must be a deflation system, which functions using gas fees. \\
        \hline
    \end{tabular}
\end{center}
\egroup{}

\bgroup{}
\def\arraystretch{1.25}
\begin{center}
    \begin{tabular}{ |l|p{9cm}| }
        \hline
        \multicolumn{2}{|c|}{\textbf{Req-04}} \\
        \hline
        \textbf{Name} & Smart Contract \\
        \hline
        \textbf{Priority} & 2 \\
        \hline
        \textbf{Version} & 1.0 \\
        \hline
        \textbf{Notes} & none \\
        \hline
        \textbf{Description} & There must be a system that generates a smart contract that is self-executing, containing the terms of the agreement between buyer and seller written directly in lines of code. \\
        \hline
        \multicolumn{2}{|c|}{\textbf{Subrequirements}} \\
        \hline
        \textbf{Req-01\_0} & There must be an algorithm dedicated to defalcation system for the transaction of the smart contract with gas fees. \\
        \hline
        \textbf{Req-01\_1} & The code and the agreements in it must exist on the decentralized blockchain. \\
        \hline
        \textbf{Req-01\_2} & The code controls execution and transactions are traceable and irreversible. \\
        \hline
    \end{tabular}
\end{center}
\egroup{}

\bgroup{}
\def\arraystretch{1.25}
\begin{center}
    \begin{tabular}{ |l|p{9cm}| }
        \hline
        \multicolumn{2}{|c|}{\textbf{Req-05}} \\
        \hline
        \textbf{Name} & WebApp \\
        \hline
        \textbf{Priority} & 2 \\
        \hline
        \textbf{Version} & 1.0 \\
        \hline
        \textbf{Notes} & none \\
        \hline
        \textbf{Description} & It is required that from a web application any user can request and see the basic information of the blockchain (transaction, block, ...). \\
        \hline
        \multicolumn{2}{|c|}{\textbf{Subrequirements}} \\
        \hline
        \textbf{Req-01\_0} & There must be a section on the site dedicated to information about blocks, transactions, gas fees. \\
        \hline
        \textbf{Req-01\_1} & There must be a section on the site that allows the user to generate a wallet. \\
        \hline
        \textbf{Req-01\_2} & There must be a section on the site that allows the user to carry out and control their transactions. \\
        \hline
        \textbf{Req-01\_3} & There must be a section in the site that allows the user to carry out the proof of stake, that is to block a determined quantity of coins in order to be chosen as validator. \\
        \hline
    \end{tabular}
\end{center}
\egroup{}

\bgroup{}
\def\arraystretch{1.25}
\begin{center}
    \begin{tabular}{ |l|p{9cm}| }
        \hline
        \multicolumn{2}{|c|}{\textbf{Req-06}} \\
        \hline
        \textbf{Name} & Info Website \\
        \hline
        \textbf{Priority} & 3 \\
        \hline
        \textbf{Version} & 1.0 \\
        \hline
        \textbf{Notes} & Required by the mandator, but optional. \\
        \hline
        \textbf{Description} & It is required a website that explain how the blockchain works and how we've done it. \\
        \hline
        \multicolumn{2}{|c|}{\textbf{Subrequirements}} \\
        \hline
        \textbf{Req-01\_0} & IDK. \\
        \hline
    \end{tabular}
\end{center}
\egroup{}

\pagebreak

\section{Design change}

This design change is related to how a user interacts with the blockchain. \\
Our initial idea was to develop a \textit{client} software alongside the \textit{node} software.
The \textit{client} would connect to a single node as an entry to the blockchain to broadcast its transactions.
The user would then be able to broadcast transactions to the blockchain using a web-based application. \\
This is a poor design choice since it has a number of problems.

\begin{itemize}
    \item \textbf{Problem 1} Dual-functionality: Each node would need to be able to handle and distinguish both a connection
    from a node and a connection from a client.
    \item \textbf{Problem 2} WebAssembly: Both the \textit{client} and \textit{node} software would share the same
    protocol implementation, written in Java. Since the application is web-based, we would need to
    compile the \textit{client} code to WebAssembly (WASM) to run on the browser.
    \item \textbf{Problem 2.1} Sockets: It would be challenging to allow for \textit{socket connections}
    from a Java-based WASM.
    \item \textbf{Problem 3} Peer discovery: The client software can't store the addresses of other nodes
    since it is a web-based application. Even by caching nodes using \textit{cookies}, clients will generally
    need to rely on \textit{seeders} more than they should.
\end{itemize}

The solution is to completly remove the client. Only nodes can broacast transactions throughout the network.
The web application will send requests to a server, which is also a node.
This server will route the user transactions through its node.
No WebAssembly is needed. Connection to the seeder will be established (possibly) only the first time the web
application server's node connects to the blockchain. Users can still host their own node and use them as an entry to the network, and
multiple users can host their own web application for the same purpose.

\end{document}

% COMPILE FROM resources/:
% lualatex documentation.tex; mv documentation.pdf ..

% COMPILE FROM ROOT
% cd mandate/resources; lualatex documentation.tex; mv documentation.pdf ..; cd ../..

Peer Discovery:
The seed must contain a list of the last 1000 ip's (and also the port) active on the blockchain.
If a machine wants to connect to the blockchain for the first time, it must first ask a seed for 100 random ip's
that the seed believes are active. Once these ip's are saved in the appropriate table in the local database,
the machine can start to search for a node on the blockchain, using the saved ip's.
When it finds an active node it asks for the ip it knows, at this point the machine becomes
a node of the blockchain that can communicate with other nodes.
Alive status:
Every 5 min both between nodes themselves and between node and seed, there is a communication from the node,
which notifies its state of alive on the blockchain.